## 선착순 티켓 예매 사이트 by TDD

프로젝트 목적 : 티켓 선착순 예매를 위해 대용량 트래픽이 순간적으로 몰렸을 때, 적절한 처리 방안을 모색하고
구현하며 트러블 슈팅을 하는 소규모 사이드 프로젝트
추가: 관리자 기능은 따로 만들지 않을 것이기에, 공연(한화이글스 vs LG트윈스 한국시리즈), 좌석, 최대 구매 가능 티켓 수 등은 임의로 생성 한 뒤, 

### 기능 요구사항 정리

- [] auth
  - [ ] 회원가입을 할 수 있어야 한다.
    - [ ] 비밀번호는 해시로 저장되어야 한다. (암호화 종류, 장단점 조사분석)
    - [ ] 아이디는 이메일로 진행하고, 중복 가입은 허용되지 않는다. (검증 방식은 여러개? 검증 코드는 어디에 두나? 클래스 위치)
  - [ ] 로그인을 할 수 있어야 한다.

- [ ] reservation
  - [ ] 예매를 진행할 수 있어야 한다. (한 사람 당 최대 4장)
  - [ ] 예약이 동시에 진행될 때 oversell이 되어서는 안된다.
  - [ ] 일정 요청 수 가 x를 넘어가면 대기 큐를 생성하여 진입하여야 한다.


- [ ] 관리자
  - [ ] 특정 공연에 대해 좌석, 티켓 종류와 최대 판매 수량을 설정한다.



### TDD
- [ ] auth
  - [x] 정상 입력값이면 Member가 생성된다
  - [x] 비밀번호는 해시로 암호화되어 저장된다.
- [ ] email
  - [x] 올바르지 않은 이메일이면 Email 생성을 실패한다
  - [x] 올바른 이메일이면 Email 생성을 성공한다
  - [x] 중복 이메일은 허용하지 않는다.



============================GPT======================
# 선착순 티켓 예매 사이트 – 기능 요구사항 (TDD용)

## 2. 선착순 티켓 예매 사이트 – 기능 요구사항 깔끔하게 정리

지금 적어둔 걸 기반으로, TDD 하기 좋게 요구사항을 좀 더 구조적으로 정리해둔 문서입니다.  
(기본/필수 위주 + 확장 가능성까지 포함)

---

### 2-1. Auth (인증/회원)

- 회원가입을 할 수 있어야 한다.
    - 이메일(or 아이디) + 비밀번호로 회원가입
    - 비밀번호는 해시로 저장되어야 한다.
    - 이미 가입된 이메일로는 중복 가입이 안 되어야 한다.
- 로그인을 할 수 있어야 한다.
    - 올바른 이메일 + 비밀번호 → 로그인 성공
    - 틀린 비밀번호 → 로그인 실패
- 로그인한 사용자만 티켓 예매 기능을 사용할 수 있다. (예약 API 보호)

*(추후 확장용, 지금은 옵션)*

- 세션/토큰 기반 인증 (JWT든 세션이든 방식 선택)
- 내 정보/로그아웃 기능

---

### 2-2. 공연/티켓(상품) 관리

- 특정 공연(또는 이벤트)에 대해 **티켓 종류**와 **최대 판매 수량(재고)** 을 설정할 수 있어야 한다.
- 공연(이름, 날짜/시간, 장소 등)을 등록할 수 있다.
- 각 공연마다 “예매 가능한 티켓 수량(totalStock)”을 설정한다.
- 현재 남은 재고 수량을 조회할 수 있어야 한다.
    - 관리자/운영자용 재고 확인
    - (선택) 사용자에게도 남은 수량 또는 매진 여부를 보여줄 수 있다.

---

### 2-3. 예약(선착순 티켓 예매) – 핵심 도메인

이 부분이 TDD 1순위 타겟이다.

- 한 사람당 최대 4장의 티켓을 예매할 수 있다.
    - 한 번의 예매 요청에서 티켓 수량은 1~4장 사이여야 한다.
    - 0장 또는 4장 초과 요청 시 예매는 실패해야 한다.
    - (선택) 같은 공연에 대해 여러 번 나눠서 예매하는 경우,  
      누적 수량이 4장을 넘으면 안 된다.
- 재고가 0이면 예약은 실패해야 한다.
- 남은 티켓 수량이 요청 수량보다 적으면 실패해야 한다.
    - 실패 시, 재고는 변하지 않아야 한다.
- 동시에 예약을 진행할 때, oversell(초과 판매)이 되어서는 안 된다.
    - 같은 공연에 대해 여러 사용자가 동시에 예매 요청을 하더라도,  
      실제로 확정된 총 예매 수량이 설정된 최대 재고를 넘지 않아야 한다.
    - “재고가 1장 남았을 때, 두 명이 동시에 1장씩 요청” →  
      정확히 한 명만 성공, 한 명은 “재고 부족/매진” 응답.
- 한 번의 예매 요청은 “성공/실패”가 명확해야 한다.
    - 성공 시: 예약 ID, 예매 수량, 공연 정보 등을 응답
    - 실패 시: 실패 이유(재고 부족, 최대 수량 초과 등)를 알려줘야 한다.

---

### 2-4. 중복 요청 / 안정성 관련

실제 고부하 상황을 생각하면 꼭 필요한 요구사항이다.

- 같은 요청이 여러 번 들어와도 **중복으로 예매가 발생하면 안 된다.**
    - (선택) 같은 사용자, 같은 공연, 같은 “요청 키(idempotency key)”로 여러 번 요청 하더라도,  
      실제 예약은 한 번만 발생해야 한다.
- 네트워크 문제로 사용자가 새로고침/뒤로가기/재시도해도 중복 예매 되지 말 것.
- 예매 처리 중 장애가 발생하더라도 **데이터 일관성**이 깨지면 안 된다.
    - 예매 도중 에러 발생 시, 성공하지 않은 예약은 확정으로 남으면 안 된다.
    - 트랜잭션 롤백 또는 적절한 보상 로직으로 일관성을 유지해야 한다.

---

### 2-5. 고부하 / 동시성 / 성능 요구사항 (비기능)

- 동시에 수천·수만 명이 몰려도 핵심 기능이 정상 동작해야 한다.
- 동시 예매 요청 시에도 oversell이 발생하지 않아야 한다.
- 동시 로그인/조회/예매 요청이 와도 시스템이 심각하게 느려지거나 장애가 나지 않도록 설계해야 한다.
- 예매 요청 처리 시간
    - (목표) 평균 응답 시간은 N ms 이하 (추후 구체화 가능)
    - 타임아웃 설정 및 적절한 에러 응답이 있어야 한다.
- 장애 감지 및 로그
    - 예매 실패/에러 상황을 로그로 남겨 나중에 분석 가능해야 한다.

---

### 2-6. 내 예약 조회 / 취소 (선택 기능, 나중 단계에서 TDD 해도 됨)

지금 바로 안 만들어도 되지만, 실제 서비스스러워지려면 보통 필요하다.

- 사용자는 “내가 예매한 티켓 목록”을 조회할 수 있어야 한다.
    - 공연 이름, 일시, 예매 수량, 상태(확정/취소 등)
- (선택) 사용자는 예매를 취소할 수 있다.
    - 취소 가능 조건(공연 시작 전까지 등)을 정책으로 둘 수 있다.
    - 취소 시, 재고가 다시 늘어날지 여부는 정책에 따라 결정한다.

---

### 2-7. 관리자/운영자 기능 (추후 확장용)

- 공연(이벤트) 등록/수정/삭제 기능
- 공연별 예매 현황 조회
    - 총 판매 수, 남은 재고, 예매자 목록 등
- (선택) 장애/에러 로그 조회

---

### 2-8. TDD 관점에서 먼저 잡을 “최우선 요구사항”

“TDD로 시작할 때” 우선순위를 정해보면:

1. **예약 도메인 핵심 규칙**
    - 재고가 있을 때 성공
    - 재고 부족/0일 때 실패
    - 한 사람당 최대 4장 제한
    - oversell 방지 (동시성 로직)

2. **그 다음**
    - 회원가입/로그인 (예매 보호용)
    - 내 예매 조회

3. **그 이후**
    - 중복 요청 방지(idempotency)
    - 예매 취소, 관리자 기능
    - 성능/부하 테스트, 장애 상황 시나리오

이 순서대로 요구사항을 하나씩 TDD 사이클(Red → Green → Refactor)로 잡고 가면 된다.
